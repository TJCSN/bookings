<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Booking System</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #6a5acd, #8a6dd9);
      color: #333;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      max-width: 1000px;
      margin: 40px auto;
      gap: 20px;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      flex: 1;
      min-width: 300px;
      padding: 20px;
    }
    h2 { margin-top: 0; }
    .calendar {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 15px;
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      text-align: center;
    }
    .day {
      padding: 8px;
      border-radius: 6px;
      cursor: pointer;
    }
    .day:hover { background: #eee; }
    .selected { background: #6a5acd; color: #fff; }
    label { font-weight: bold; display: block; margin-top: 10px; }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      margin-top: 15px;
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      background: #6a5acd;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover { background: #5a4ac7; }
    .refresh { background: #22c55e; }
    #formNote { margin-top: 8px; font-size: 14px; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Make a Booking -->
    <div class="card">
      <h2>Make a Booking</h2>
      <div class="calendar">
        <div class="calendar-header">
          <span id="monthLabel">January 2026</span>
          <div>
            <button type="button" onclick="prevMonth()">‹</button>
            <button type="button" onclick="nextMonth()">›</button>
          </div>
        </div>
        <div class="calendar-grid" id="calendarGrid"></div>
      </div>
      <div id="selectedDate">Wednesday, January 28, 2026</div>
      <form id="bookingForm">
        <label>Your Name *</label>
        <input type="text" id="name" required>
        <label>Select Craft *</label>
        <select id="craft" required>
          <option value="">Choose a craft</option>
          <option>Kayak</option>
          <option>Canoe</option>
          <option>Paddleboard</option>
        </select>
        <label>Start Time *</label>
        <input type="time" id="startTime" value="09:00" required>
        <label>End Time *</label>
        <input type="time" id="endTime" required>
        <button type="submit">Create Booking</button>
        <div id="formNote"></div>
      </form>
    </div>

    <!-- All Bookings -->
    <div class="card">
      <h2>All Bookings</h2>
      <button class="refresh" id="refreshBtn">Refresh</button>
      <div id="bookingsList">Loading bookings...</div>
    </div>
  </div>

  <script>
    // Calendar logic
    let currentMonth = 0; // January
    let currentYear = 2026;
    let selectedDate = new Date(2026,0,28);

    function renderCalendar() {
      const grid = document.getElementById('calendarGrid');
      grid.innerHTML = '';
      const monthLabel = document.getElementById('monthLabel');
      const monthName = new Intl.DateTimeFormat('en-US',{month:'long'}).format(new Date(currentYear,currentMonth));
      monthLabel.textContent = monthName + ' ' + currentYear;

      const firstDay = new Date(currentYear,currentMonth,1).getDay();
      const daysInMonth = new Date(currentYear,currentMonth+1,0).getDate();

      for(let i=0;i<firstDay;i++) grid.innerHTML += '<div></div>';
      for(let d=1; d<=daysInMonth; d++) {
        const dateObj = new Date(currentYear,currentMonth,d);
        const div = document.createElement('div');
        div.className = 'day';
        div.textContent = d;
        if(dateObj.toDateString()===selectedDate.toDateString()) div.classList.add('selected');
        div.onclick = ()=>{ selectedDate=dateObj; updateSelected(); renderCalendar(); };
        grid.appendChild(div);
      }
    }
    function updateSelected(){
      document.getElementById('selectedDate').textContent =
        new Intl.DateTimeFormat('en-US',{weekday:'long',month:'long',day:'numeric',year:'numeric'}).format(selectedDate);
    }
    function prevMonth(){ currentMonth--; if(currentMonth<0){currentMonth=11; currentYear--;} renderCalendar(); }
    function nextMonth(){ currentMonth++; if(currentMonth>11){currentMonth=0; currentYear++;} renderCalendar(); }

    // Form submission
    document.getElementById('bookingForm').onsubmit = function(e){
      e.preventDefault();
      const name = document.getElementById('name').value;
      const craft = document.getElementById('craft').value;
      const start = document.getElementById('startTime').value;
      const end = document.getElementById('endTime').value;
      const date = selectedDate.toISOString().split('T')[0];

      google.script.run.withSuccessHandler(msg => {
        const note = document.getElementById('formNote');
        note.textContent = msg;
        note.style.color = msg.startsWith("Error") ? "#ef4444" : "#16a34a";
        if (!msg.startsWith("Error")) loadBookings();
      }).createBooking(name, craft, date, start, end);
    };

    // Refresh bookings
    function loadBookings(){
      google.script.run.withSuccessHandler(bookings => {
        const list = document.getElementById('bookingsList');
        if(bookings.length === 0){
          list.textContent = "No bookings yet.";
          return;
        }
        list.innerHTML = bookings.map(b =>
          `<div><strong>${b.name}</strong> booked ${b.craft} on ${b.date} (${b.startTime}–${b.endTime})</div>`
        ).join("");
      }).listBookings();
    }

    document.getElementById('refreshBtn').addEventListener('click', loadBookings);

    // Initial render
    renderCalendar();
    updateSelected();
    loadBookings();
  </script>
</body>
</html>
